<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>t4mpsrTenants Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a>  </div>
  <div class="headertitle">
<h1>t4mpsrTenants Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="t4mpsrTenants" -->
<p>Class to handle tenant related functions.  
<a href="#_details">More...</a></p>

<p><a href="classt4mpsrTenants-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#a273240094b0529903f9c6a68c1d36ce9">__construct</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Class constructor.  <a href="#a273240094b0529903f9c6a68c1d36ce9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#a724f57beb7abab7ef4cce5d52cb0605a">GetTenantBalanceList</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieves the tenant and balance list from the database.  <a href="#a724f57beb7abab7ef4cce5d52cb0605a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3bb8874072d5e45347a2d9f86a839685"></a><!-- doxytag: member="t4mpsrTenants::GetTenantBalanceByID" ref="a3bb8874072d5e45347a2d9f86a839685" args="($id)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>GetTenantBalanceByID</b> ($id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae4c9a6d24f9542ea81e64dc23912b77d"></a><!-- doxytag: member="t4mpsrTenants::GetGlobalBalance" ref="ae4c9a6d24f9542ea81e64dc23912b77d" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>GetGlobalBalance</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a70832822b5ba5d752a918f172b8c5018"></a><!-- doxytag: member="t4mpsrTenants::GetGlobalSpares" ref="a70832822b5ba5d752a918f172b8c5018" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>GetGlobalSpares</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#a5adcbd5941f6d4ddee4c1cb181c8b798">GetTenantList</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieves the tenant and balance list from the database.  <a href="#a5adcbd5941f6d4ddee4c1cb181c8b798"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a40af737e7a0a401652bd8413e169677b"></a><!-- doxytag: member="t4mpsrTenants::GetAllTenantList" ref="a40af737e7a0a401652bd8413e169677b" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>GetAllTenantList</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a31b92bb687b380a04ac8a08e47259503"></a><!-- doxytag: member="t4mpsrTenants::GetTenantNameByID" ref="a31b92bb687b380a04ac8a08e47259503" args="($id)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>GetTenantNameByID</b> ($id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#ab23154e2613f6b2a513200cbf38637e3">ModifyTenantGroupsByPost</a> ($PostArray)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Modify the tenant groups based on the raw POST data which looks like this:  <a href="#ab23154e2613f6b2a513200cbf38637e3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#aefeab509f85992dc29a0bc4f3cafb94d">getTenantGroupList</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieves the tenant groups' list from the database.  <a href="#aefeab509f85992dc29a0bc4f3cafb94d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#aedc674d09da1c9a392e106e19363628f">addTenant</a> ($TenantName)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Inserts a new tenant into the database.  <a href="#aedc674d09da1c9a392e106e19363628f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac451a5b9f37cf73f9902643b5b12c733"></a><!-- doxytag: member="t4mpsrTenants::InsertPayment" ref="ac451a5b9f37cf73f9902643b5b12c733" args="($iid, $iamount, $idate, $icomment)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>InsertPayment</b> ($iid, $iamount, $idate, $icomment)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a815e8c9b8cd4a3f4f97be751d7c37dd1"></a><!-- doxytag: member="t4mpsrTenants::addDonation" ref="a815e8c9b8cd4a3f4f97be751d7c37dd1" args="($tid, $amount, $note)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>addDonation</b> ($tid, $amount, $note)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad94092622aa1fb868a86378eac0c8716"></a><!-- doxytag: member="t4mpsrTenants::SaveExpenses" ref="ad94092622aa1fb868a86378eac0c8716" args="($expenseData, $expenseDate, $expenseNote)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>SaveExpenses</b> ($expenseData, $expenseDate, $expenseNote)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af552a5ca908553f0b78c567ad3e8cfe0"></a><!-- doxytag: member="t4mpsrTenants::GetIndividualTenants" ref="af552a5ca908553f0b78c567ad3e8cfe0" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>GetIndividualTenants</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a561b97c894ca55741a0d0e1039926800"></a><!-- doxytag: member="t4mpsrTenants::GetTenantGroups" ref="a561b97c894ca55741a0d0e1039926800" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>GetTenantGroups</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#acf6a2c31c68223771d728e7bd63aaea2">delTenant</a> ($TenantID)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deletes a tenant from the database.  <a href="#acf6a2c31c68223771d728e7bd63aaea2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae5fc57710c229c1f4012b6b7d323784b"></a><!-- doxytag: member="t4mpsrTenants::getKeyInfo" ref="ae5fc57710c229c1f4012b6b7d323784b" args="($key)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>getKeyInfo</b> ($key)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#a33ea614b99134980072aa0fd81b42458">flipTenant</a> ($TenantID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#a6aa79a24ce57f5d20201307211ad5f66">addTenantGroup</a> ($TenantGroupName)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Inserts a new tenant group into the database.  <a href="#a6aa79a24ce57f5d20201307211ad5f66"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1c4b767050b40e54e974a0c8fdee742d"></a><!-- doxytag: member="t4mpsrTenants::$pdo" ref="a1c4b767050b40e54e974a0c8fdee742d" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#a1c4b767050b40e54e974a0c8fdee742d">$pdo</a> = null</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PDO database object. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7fcdb4b4e441898d63d5cba22dcb8829"></a><!-- doxytag: member="t4mpsrTenants::$tpl" ref="a7fcdb4b4e441898d63d5cba22dcb8829" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#a7fcdb4b4e441898d63d5cba22dcb8829">$tpl</a> = null</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">smarty template object <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a51a472a32e8e4f82f31a09498859fe79"></a><!-- doxytag: member="t4mpsrTenants::$error" ref="a51a472a32e8e4f82f31a09498859fe79" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#a51a472a32e8e4f82f31a09498859fe79">$error</a> = null</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">error messages <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adec37585dd25fe1a225cb6664e9cbbe6"></a><!-- doxytag: member="t4mpsrTenants::$dbtype" ref="adec37585dd25fe1a225cb6664e9cbbe6" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#adec37585dd25fe1a225cb6664e9cbbe6">$dbtype</a> = 'mysql'</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PDO database type. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab9a3ad362e6decc214054623398c39b1"></a><!-- doxytag: member="t4mpsrTenants::$dbname" ref="ab9a3ad362e6decc214054623398c39b1" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#ab9a3ad362e6decc214054623398c39b1">$dbname</a> = 't4mpsr'</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PDO database name. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8a4312c57dc00d962d4b5b23fc2d5dc2"></a><!-- doxytag: member="t4mpsrTenants::$dbhost" ref="a8a4312c57dc00d962d4b5b23fc2d5dc2" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#a8a4312c57dc00d962d4b5b23fc2d5dc2">$dbhost</a> = '172.16.234.4'</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PDO database host. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a79330965cac41e43a442756c115285c4"></a><!-- doxytag: member="t4mpsrTenants::$dbuser" ref="a79330965cac41e43a442756c115285c4" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#a79330965cac41e43a442756c115285c4">$dbuser</a> = 't4mpsr'</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PDO database username. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acec7a59dc446a5fbbaec55593355d01f"></a><!-- doxytag: member="t4mpsrTenants::$dbpass" ref="acec7a59dc446a5fbbaec55593355d01f" args="" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classt4mpsrTenants.html#acec7a59dc446a5fbbaec55593355d01f">$dbpass</a> = 't4mpsr.pwd.%'</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PDO database password. <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Class to handle tenant related functions. </p>
<p>Class functions:</p>
<ul>
<li>database modification</li>
<li>file management (if any) </li>
</ul>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a273240094b0529903f9c6a68c1d36ce9"></a><!-- doxytag: member="t4mpsrTenants::__construct" ref="a273240094b0529903f9c6a68c1d36ce9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">t4mpsrTenants::__construct </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Class constructor. </p>
<p>During the initialisation:</p>
<ul>
<li>instantiate the pdo object </li>
</ul>

<p><div class="fragment"><pre class="fragment">                           {

        <span class="comment">// instantiate the pdo object</span>
        <span class="keywordflow">try</span> {
            $dsn = <span class="stringliteral">&quot;{$this-&gt;dbtype}:host={$this-&gt;dbhost};dbname={$this-&gt;dbname}&quot;</span>;
            $this-&gt;pdo = <span class="keyword">new</span> PDO($dsn, $this-&gt;dbuser, $this-&gt;dbpass, array(PDO::MYSQL_ATTR_INIT_COMMAND =&gt; <span class="stringliteral">&quot;SET NAMES utf8&quot;</span>));
        } <span class="keywordflow">catch</span> (PDOException $e) {
            print <span class="stringliteral">&quot;Error!: &quot;</span> . $e-&gt;getMessage();
            die();
        }
    }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="aedc674d09da1c9a392e106e19363628f"></a><!-- doxytag: member="t4mpsrTenants::addTenant" ref="aedc674d09da1c9a392e106e19363628f" args="($TenantName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">t4mpsrTenants::addTenant </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>TenantName</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Inserts a new tenant into the database. </p>
<p>By default any new tenant is active, and not member of any tenant group.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$TenantName</em>&nbsp;</td><td>the tenant name (what a surprise) </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment">                                    {
        <span class="keywordflow">try</span> {
            $rh = $this-&gt;pdo-&gt;prepare(<span class="stringliteral">&quot;insert into tenants (name,active) values (&#39;$TenantName&#39;, 1)&quot;</span>);
            $rh-&gt;execute();
        } <span class="keywordflow">catch</span> (PDOException $e) {
            print <span class="stringliteral">&quot;Error!: &quot;</span> . $e-&gt;getMessage();
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6aa79a24ce57f5d20201307211ad5f66"></a><!-- doxytag: member="t4mpsrTenants::addTenantGroup" ref="a6aa79a24ce57f5d20201307211ad5f66" args="($TenantGroupName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">t4mpsrTenants::addTenantGroup </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>TenantGroupName</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Inserts a new tenant group into the database. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$TenantGroupName</em>&nbsp;</td><td>the tenant group name </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment">                                              {

        <span class="comment">// purge unused group first</span>
        $rh = $this-&gt;pdo-&gt;prepare(<span class="stringliteral">&quot;delete from tenant_groups where id not in (select distinct jointid from tenants);&quot;</span>);
        $rh-&gt;execute();

        <span class="keywordflow">try</span> {
            $rh = $this-&gt;pdo-&gt;prepare(<span class="stringliteral">&quot;insert into tenant_groups (name) values(&#39;$TenantGroupName&#39;)&quot;</span>);
            $rh-&gt;execute();
        } <span class="keywordflow">catch</span> (PDOException $e) {
            print <span class="stringliteral">&quot;Error!: &quot;</span> . $e-&gt;getMessage();
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acf6a2c31c68223771d728e7bd63aaea2"></a><!-- doxytag: member="t4mpsrTenants::delTenant" ref="acf6a2c31c68223771d728e7bd63aaea2" args="($TenantID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">t4mpsrTenants::delTenant </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>TenantID</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deletes a tenant from the database. </p>
<p>Since the proper tables are have foreign key constraint and on delete cascade, removing any tenant from the db automatically removes all the tenant's transfers.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$TenantName</em>&nbsp;</td><td>the tenant name (what a surprise) </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment">                                  {
        <span class="keywordflow">try</span> {
            $rh = $this-&gt;pdo-&gt;prepare(<span class="stringliteral">&quot;delete from tenants where id=$TenantID;&quot;</span>);
            $rh-&gt;execute();
        } <span class="keywordflow">catch</span> (PDOException $e) {
            print <span class="stringliteral">&quot;Error!: &quot;</span> . $e-&gt;getMessage();
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a33ea614b99134980072aa0fd81b42458"></a><!-- doxytag: member="t4mpsrTenants::flipTenant" ref="a33ea614b99134980072aa0fd81b42458" args="($TenantID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">t4mpsrTenants::flipTenant </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>TenantID</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$TenantName</em>&nbsp;</td><td>the tenant name (what a surprise) </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment">                                   {
        <span class="keywordflow">try</span> {
            $rh = $this-&gt;pdo-&gt;prepare(<span class="stringliteral">&quot;update tenants set active = active xor 1 where id=$TenantID;&quot;</span>);
            $rh-&gt;execute();
        } <span class="keywordflow">catch</span> (PDOException $e) {
            print <span class="stringliteral">&quot;Error!: &quot;</span> . $e-&gt;getMessage();
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a724f57beb7abab7ef4cce5d52cb0605a"></a><!-- doxytag: member="t4mpsrTenants::GetTenantBalanceList" ref="a724f57beb7abab7ef4cce5d52cb0605a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">t4mpsrTenants::GetTenantBalanceList </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieves the tenant and balance list from the database. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The tenant list </dd></dl>

<p><div class="fragment"><pre class="fragment">                                    {
        <span class="keywordflow">try</span> {
            <span class="keywordflow">foreach</span> ($this-&gt;pdo-&gt;query(<span class="stringliteral">&quot;</span>
<span class="stringliteral">select</span>
<span class="stringliteral">          t.id as tid</span>
<span class="stringliteral">        , t.name</span>
<span class="stringliteral">        , coalesce(i.amount, 0) - coalesce(p.amount, 0) as balance</span>
<span class="stringliteral">from tenants as t</span>
<span class="stringliteral">left join (</span>
<span class="stringliteral">        select tid, sum(amount) as amount</span>
<span class="stringliteral">        from expenses</span>
<span class="stringliteral">        group by 1</span>
<span class="stringliteral">) as p</span>
<span class="stringliteral">on t.id = p.tid</span>
<span class="stringliteral">left join (</span>
<span class="stringliteral">        select tid, sum(amount) as amount</span>
<span class="stringliteral">        from incomes</span>
<span class="stringliteral">        group by 1</span>
<span class="stringliteral">) as i</span>
<span class="stringliteral">on t.id = i.tid</span>
<span class="stringliteral">&quot;</span>) as $row)
                $rows[] = $row;
        } <span class="keywordflow">catch</span> (PDOException $e) {
            print <span class="stringliteral">&quot;Error!: &quot;</span> . $e-&gt;getMessage();
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">return</span> $rows;
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aefeab509f85992dc29a0bc4f3cafb94d"></a><!-- doxytag: member="t4mpsrTenants::getTenantGroupList" ref="aefeab509f85992dc29a0bc4f3cafb94d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">t4mpsrTenants::getTenantGroupList </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieves the tenant groups' list from the database. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The tenant geoups' list </dd></dl>

<p><div class="fragment"><pre class="fragment">                                  {
        <span class="keywordflow">try</span> {
            <span class="keywordflow">foreach</span> ($this-&gt;pdo-&gt;query(<span class="stringliteral">&quot;select * from tenant_groups;&quot;</span>) as $row)
                $rows[] = $row;
        } <span class="keywordflow">catch</span> (PDOException $e) {
            print <span class="stringliteral">&quot;Error!: &quot;</span> . $e-&gt;getMessage();
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">return</span> $rows;
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5adcbd5941f6d4ddee4c1cb181c8b798"></a><!-- doxytag: member="t4mpsrTenants::GetTenantList" ref="a5adcbd5941f6d4ddee4c1cb181c8b798" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">t4mpsrTenants::GetTenantList </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieves the tenant and balance list from the database. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The tenant list </dd></dl>

<p><div class="fragment"><pre class="fragment">                             {
        <span class="keywordflow">try</span> {
            <span class="keywordflow">foreach</span> ($this-&gt;pdo-&gt;query(<span class="stringliteral">&quot;select * from tenants where active=true;&quot;</span>) as $row)
                $rows[] = $row;
        } <span class="keywordflow">catch</span> (PDOException $e) {
            print <span class="stringliteral">&quot;Error!: &quot;</span> . $e-&gt;getMessage();
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">return</span> $rows;
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab23154e2613f6b2a513200cbf38637e3"></a><!-- doxytag: member="t4mpsrTenants::ModifyTenantGroupsByPost" ref="ab23154e2613f6b2a513200cbf38637e3" args="($PostArray)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">t4mpsrTenants::ModifyTenantGroupsByPost </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>PostArray</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Modify the tenant groups based on the raw POST data which looks like this: </p>
<pre>
 array(6) {
            ["menuitem"]=&gt; string(9) "addtenant" 
            ["dropdown1"]=&gt; string(1) "0"
            ["dropdown2"]=&gt; string(1) "2"
            ["dropdown3"]=&gt; string(1) "2"
            ["dropdown4"]=&gt; string(1) "0"
            ["dropdown5"]=&gt; string(1) "0"
 }
 </pre><p> or whatewer a DRPDWN has been set. Yes, this function has plenty room to improve but ATM I don't care because in normal circumstates it has no real effect. </p>

<p><div class="fragment"><pre class="fragment">                                                  {
        <span class="comment">// new empty array</span>
        $FilteredArray = array();

        <span class="comment">// pattern to find the uneccessary &#39;dropdown&#39; string</span>
        $patt = <span class="charliteral">&#39;/&#39;</span> . DRPDWN . <span class="stringliteral">&#39;\d+/&#39;</span>;

        <span class="comment">// create a new array containing the user id, tenant group id pairs only.</span>
        <span class="keywordflow">foreach</span> ($PostArray as $k =&gt; $v) {
            <span class="keywordflow">if</span> (preg_match($patt, $k))
                $FilteredArray[substr($k, strlen(DRPDWN))] = $v;
        }

        <span class="comment">// good we have the pure data now check its validity and process</span>
        <span class="keywordflow">foreach</span> ($FilteredArray as $uid =&gt; $tgid) {

            <span class="comment">// count if at least two member of a group and the group is other than zero</span>
            <span class="comment">// because zero means no group</span>
            <span class="keywordflow">if</span> (count(preg_grep(<span class="stringliteral">&#39;/^&#39;</span> . $tgid . <span class="stringliteral">&#39;$/&#39;</span>, $FilteredArray)) &gt; 1 &amp;&amp; $tgid &gt; 0) {

                <span class="comment">// user $uid is member of $tgid - some error handling would be nice anway</span>
                $db = $this-&gt;pdo-&gt;query(<span class="stringliteral">&quot;update tenants set jointid=$tgid where id=$uid;&quot;</span>);
                $db-&gt;execute();
            } <span class="keywordflow">else</span> {
                <span class="comment">// The group in question now has one or no members so</span>
                $db = $this-&gt;pdo-&gt;query(<span class="stringliteral">&quot;update tenants set jointid=0 where id=$uid;&quot;</span>);
                $db-&gt;execute();
            }
        }
    }
</pre></div></p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/usr/share/wordpress/t4mpsr/lib/tenants.php</li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Sun Jan 6 2013 16:24:52 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
